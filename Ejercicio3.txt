CREATE OR ALTER PROCEDURE gestionarCorreo
AS BEGIN
   DECLARE @correo VARCHAR(MAX)
   DECLARE @asunto VARCHAR(MAX)
   DECLARE @remitente VARCHAR(MAX)
   DECLARE cursorCorreo CURSOR FOR 
   SELECT correo, asunto, remitente
   FROM dbo.gestionCorreo
   OPEN cursorCorreo
   FETCH NEXT FROM cursorCorreo INTO @correo, @asunto, @remitente
   WHILE @@FETCH_STATUS=0
   BEGIN
        IF (@correo LIKE('%@salesianosalcala.com')) BEGIN
            UPDATE dbo.gestionCorreo
            SET accion='mover a importante'
            WHERE correo=@correo
        END
            IF (UPPER(@asunto) IN('IMPORTANTE','URGENTE','PRIORITARIO')) BEGIN
                UPDATE dbo.gestionCorreo
                SET accion='mover a muy importante'
                WHERE correo=@correo
            END
                ELSE IF(UPPER(@remitente) LIKE('%@salesianosalcala.com')) BEGIN
                    UPDATE dbo.gestionCorreo
                    SET accion='mover a correo interno'
                    WHERE correo=@correo
                END
                    ELSE BEGIN
                        UPDATE dbo.gestionCorreo
                        SET accion='mover a papelera'
                        WHERE correo=@correo
                    END
   FETCH NEXT FROM cursorCorreo INTO @correo, @asunto, @remitente
   END
   CLOSE cursorCorreo
   DEALLOCATE cursorCorreo
END
EXEC gestionarCorreo